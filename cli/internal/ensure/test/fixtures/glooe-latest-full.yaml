applications:
  - name: cert-manager
    resources:
      - path: https://github.com/jetstack/cert-manager/releases/download/v0.10.0/cert-manager-no-webhook.yaml
      - secret:
          name: cert-manager
          namespace: cert-manager
          entries:
            access_key_id:
              envVar: AWS_ACCESS_KEY_ID
            secret_access_key:
              envVar: AWS_SECRET_ACCESS_KEY
      - template:
          path: cli/internal/ensure/test/fixtures/templates/cluster_issuer.yaml
          envValues:
            AccessKeyId: AWS_ACCESS_KEY_ID
  - name: gloo
    resources:
      - id: helm-chart
        helmChart:
          repoUrl: "https://storage.googleapis.com/gloo-ee-helm/"
          chartName: gloo-ee
          repoName: gloo-ee
          version: 0.20.1
          namespace: gloo-system
          set:
            - "gloo.namespace.create=true"
            - "prometheus.enabled=false"
            - "grafana.defaultInstallationEnabled=false"
          setEnv:
            license_key: LICENSE_KEY
      - secret:
          name: aws-creds
          namespace: gloo-system
          entries:
            aws_access_key_id:
              envVar: AWS_ACCESS_KEY_ID
            aws_secret_access_key:
              envVar: AWS_SECRET_ACCESS_KEY
      - path: cli/internal/ensure/test/fixtures/upstreams/aws.yaml
      - template:
          path: cli/internal/ensure/test/fixtures/templates/glooui_virtual_service_ssl.yaml
          values:
            Domain: test-glooui.corp.solo.io
      - template:
          path: cli/internal/ensure/test/fixtures/templates/cert.yaml
          values:
            Domain: test-glooui.corp.solo.io
            Namespace: gloo-system
      - dnsEntry:
          subdomain: test-glooui
          hostedZone: corp.solo.io.
          service:
            namespace: gloo-system
            name: gateway-proxy-v2
